"use strict";window.onload=()=>{const frmQuoter=document.getElementById("frmQuoter"),curncyFrmt=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),equivUsd=Number(document.querySelector("table").rows[1].cells[1].innerText.replace(/\L/g,"")),userSalary=frmQuoter.inptQuoterSalary,salaryPrev=document.getElementById("salaryPrev");let usdSalary=0;userSalary.addEventListener("input",()=>{/[^0-9\.]/g.test(userSalary.value)&&(userSalary.value=userSalary.value.slice(0,-1));var hnlSalary=Number(userSalary.value);usdSalary=hnlSalary/equivUsd,salaryPrev.innerText="$ "+curncyFrmt.format(usdSalary)});const errInsfcntSalary=(noAvlblCnt,msg)=>{const noAvlblMsg=document.createElement("p");noAvlblMsg.className="details__message",noAvlblMsg.innerText=msg,noAvlblCnt.appendChild(noAvlblMsg)},prprtisAvlblFrgmnt=document.createDocumentFragment(),prjctsAvlblFrgmnt=document.createDocumentFragment(),prprtisAvlbl=document.getElementById("prprtisAvlbl"),prjctsAvlbl=document.getElementById("prjctsAvlbl"),showAvlblPrjcts=prjctsThatApply=>{for(var prjct of prjctsThatApply){const prjctCnt=(prjct=>{const prjctId=removeAccents(prjct.nombre.replace(/\s/g,"").toLowerCase()),prjctCnt=document.createElement("div");return prjctCnt.className="project",prjctCnt.onclick=()=>{open("https://inmozuniga.com/proyectos#"+prjctId,"_self")},prjctCnt.innerHTML=`
        <img src="" alt="${prjct.nombre}" class="project__image">
        <div class="project__data">
            <p class="project__name">${prjct.nombre}</p>
            <a href="https://inmozuniga.com/proyectos#${prjctId}" class="project__more">Saber m√°s</a>
        </div>
        `,prjctCnt})(prjct);storageRef.child("img/proyectos/"+prjct.id).getDownloadURL().then(src=>{prjctCnt.firstElementChild.src=src}),prjctsAvlblFrgmnt.appendChild(prjctCnt)}prjctsAvlbl.innerHTML="",prjctsAvlbl.appendChild(prjctsAvlblFrgmnt),0===prjctsAvlbl.children.length&&errInsfcntSalary(prjctsAvlbl,"Lo sentimos. No aplicas para ninguno de nuestros proyectos.")},showAvlblPrprtis=prprtisThatApply=>{for(var prprti of prprtisThatApply){const prprtiCnt=(prprti=>{const prprtiCnt=document.createElement("div");return prprtiCnt.className="property",prprtiCnt.id=prprti.id,prprtiCnt.innerHTML=`
        <img src="" alt="Imagen de ${prprti.nombre}" class="property__image">
        <div class="property__data">
            <p class="property__related"> 
                <a href="https://inmozuniga.com/propiedades#${prprti.categoria}-${prprti.estado}">
                    <i class="fas fa-tag"></i>
                    ${prprti.categoria}
                </a>
                <a href="https://inmozuniga.com/propiedades#${prprti.estado}">
                    <i class="fas fa-money-bill-wave"></i>
                    ${prprti.estado}
                </a>
            </p>
            <p class="property__costs"><span>${prprti.nombre}</span><span>$ ${curncyFrmt.format(prprti.cuota)}</span></p>
            <p class="property__description">${prprti.descripcion.slice(0,60)}...</p>
            <a href="https://inmozuniga.com/propiedad#${prprti.id}" class="property__link">
                Me interesa
            </a>
        </div>
        `,prprtiCnt})(prprti);storageRef.child("img/propiedades/"+prprti.id).listAll().then(file=>{file.items[0].getDownloadURL().then(src=>{prprtiCnt.firstElementChild.src=src})}),prprtisAvlblFrgmnt.appendChild(prprtiCnt)}prprtisAvlbl.innerHTML="",prprtisAvlbl.appendChild(prprtisAvlblFrgmnt),0===prprtisAvlbl.children.length&&errInsfcntSalary(prprtisAvlbl,"Lo sentimos. No aplicas para ninguna de nuestras propiedades.")},btnQuoter=document.getElementById("btnQuoter");frmQuoter.addEventListener("submit",e=>{e.preventDefault(),btnQuoter.style.pointerEvents="none";const usdSalaryAvlbl=.7*usdSalary,prprtisThatApply=[],prjctsThatApply=[];btnQuoter.value="Espera un momento",db.collection("PROYECTOS").orderBy("ingreso").get().then(prjcts=>{prjcts.forEach(prjct=>{Number(prjct.data().ingreso)<usdSalary&&prjctsThatApply.push({...prjct.data(),id:prjct.id})}),showAvlblPrjcts(prjctsThatApply)}).catch(err=>{console.log(err)}),db.collection("PROPIEDADES").orderBy("cuota").get().then(prprtis=>{prprtis.forEach(prprty=>{Number(prprty.data().cuota)<usdSalaryAvlbl&&prprtisThatApply.push({...prprty.data(),id:prprty.id})}),showAvlblPrprtis(prprtisThatApply)}).catch(err=>{console.log(err)}),setTimeout(()=>{btnQuoter.value="Cotizar",btnQuoter.style.pointerEvents="initial"},3e3)})};